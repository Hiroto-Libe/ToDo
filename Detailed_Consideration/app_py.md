# 🧩 Flaskアプリ本体 (`app.py`) 詳細設計

## 1. 🎯 目的

Flaskアプリ本体 (`app.py`) は、ToDoリストアプリにおける**ルーティング／DB処理／テンプレート描画／状態管理**の中心となるモジュールです。

---

## 2. 📁 ファイルの役割

| ファイル    | 内容                                     |
|-------------|------------------------------------------|
| `app.py`    | Flaskアプリの起動・ルーティング・DB操作の統括      |

---

## 3. 📌 使用予定モジュール・ライブラリ

| ライブラリ      | 用途                           |
|-----------------|--------------------------------|
| `flask`         | Webアプリケーション本体            |
| `sqlite3`       | 軽量DB（データ永続化）             |
| `os`            | ファイルパスや設定の管理（インスタンス用DB） |
| `datetime`（任意） | 日時管理（タスク作成日時の表示）      |

---

## 4. 🧱 構成概要

```plaintext
app.py
├── アプリ初期化
├── DB接続関数
├── 各種ルーティング関数
│   ├── `/`（一覧表示）
│   ├── `/add`（タスク追加）
│   ├── `/complete/<id>`（完了切替）
│   ├── `/delete/<id>`（削除）
│   └── `/filter/<status>`（状態別表示）
└── Flaskアプリ起動（`if __name__ == '__main__':`）
```

---

## 5. 🔧 関数設計

### 5.1 アプリ初期化

- Flaskオブジェクト作成（`Flask(__name__)`）
- `instance` フォルダを指定し、そこにDBファイルを配置
- テンプレートと静的ファイルは自動認識のため設定不要（標準構成の場合）

---

### 5.2 DB接続関数：`get_db_connection()`

- SQLiteに接続して `Row` オブジェクトで返す
- `g` コンテキストで管理（Flask標準推奨）

---

### 5.3 タスクリスト表示：`index()`

- すべてのタスクを取得
- `templates/index.html` に渡して描画

---

### 5.4 タスク追加：`add()`

- `POST` リクエストを受信
- `form` データからタスク内容を取得
- 空白チェック（バリデーション）
- DBに `INSERT` → リダイレクト

---

### 5.5 完了切替：`complete(id)`

- 指定IDの `done` フラグを反転
- DB更新 → リダイレクト

---

### 5.6 タスク削除：`delete(id)`

- 指定IDをもとに `DELETE` 実行
- リダイレクト

---

### 5.7 状態別表示：`filter(status)`

- `status = done` → `done = 1`
- `status = undone` → `done = 0`
- 条件付きクエリでタスクリストを抽出

---

## 6. 🧪 入力バリデーション

| チェック内容       | 実装方法                    |
|--------------------|-----------------------------|
| 空文字チェック     | `if not task.strip():`      |
| 文字数制限（任意） | `if len(task) > 100:`       |

---

## 7. 🚦 ルーティング定義一覧

| メソッド | パス                       | 説明                          |
|----------|----------------------------|-------------------------------|
| GET      | `/`                        | 全タスク一覧を表示               |
| POST     | `/add`                     | 新規タスクを追加                 |
| POST     | `/complete/<int:id>`       | 完了状態を切り替え                |
| POST     | `/delete/<int:id>`         | タスクを削除                    |
| GET      | `/filter/<status>`         | `done` または `undone` で絞込表示 |

---

## 8. ✅ 起動設定

```python
if __name__ == '__main__':
    app.run(debug=True)
```    
デバッグモードを有効にして開発効率を高める

.env を使えば、環境変数で設定を切り替えることも可能（発展的な運用）

---
## 9. 💡 その他実装アイデア（任意）

登録日時（created_at）を表示し、タスクの追加日時がわかるようにする

ソート機能：作成日順／完了状態順などでタスクを並び替え

エラーハンドリング：404（ページが見つからない）、500（サーバーエラー）への対応

フラッシュメッセージ：タスク追加・削除・完了時に通知を表示（Flaskの標準機能）
